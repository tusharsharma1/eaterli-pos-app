import React, {memo} from 'react';
import {
  Modal,
  SafeAreaView,
  ScrollView,
  StyleSheet,
  TouchableOpacity,
  View,
} from 'react-native';
import FontAwesome5 from 'react-native-vector-icons/FontAwesome5';
// import AppProgess from '../components/AppProgess';
// import {Grid, Row} from 'react-native-easy-grid';
import theme from '../theme';
import Text from './Text';
import AppProgess from './AppProgess';
import useWindowDimensions from '../hooks/useWindowDimensions';
import {getPercentValue} from '../helpers/app.helpers';
import useTheme from '../hooks/useTheme';
import CloseIcon from '../assets/CloseIcon';
import TimesIcon from '../assets/TimesIcon';

function _ModalContainer({
  visible,
  title,
  onRequestClose,
  hideTitle = false,
  noscroll,
  fullHeight,
  height,
  minHeight = 200,
  center,
  children,
  renderFooter,
  borderRadius = 4,
  landscapeWidth,
  width,
  widthPerc = 92,
}) {
  let themeData=useTheme();
  let {width: sw, height: sh, isPortrait} = useWindowDimensions();
  width = width ?? getPercentValue(sw, widthPerc);
  if (!isPortrait) {
    width = landscapeWidth ?? width;
  }
  height = height ?? getPercentValue(sh, 80);

  // console.log(onRequestClose);
  let ConELE = noscroll ? View : ScrollView;
  let heightProp = fullHeight ? 'height' : 'maxHeight';
  return (
    <Modal visible={visible} transparent onRequestClose={onRequestClose}>
      <SafeAreaView
        style={{
          width: '100%',
          height: '100%',
          alignItems: 'center',
          backgroundColor: 'rgba(0,0,0,0.5)',
          // paddingVertical: theme.hp(3),

          justifyContent: center ? 'center' : 'flex-start',
        }}>
        <View
          style={{
            width: width,

            //  minHeight: theme.hp(20),
            //  [heightProp]: height ? height : '92%',
            minHeight: minHeight,
            maxHeight: height,

            //  marginVertical: theme.hp(3),
            backgroundColor: themeData.modalBg,
            borderRadius: borderRadius,
            borderTopLeftRadius:0,
            borderTopRightRadius:0,
            borderTopColor:theme.colors.primaryColor,
            borderTopWidth:5,
            overflow: 'hidden',
            marginTop: 10,
            // paddingHorizontal: theme.wp(3),
            // paddingVertical: theme.wp(3),
          }}>
          {hideTitle ? (
            <View
              style={{
                // backgroundColor: '#ededed',
                //paddingVertical: theme.wp(3),
                // borderWidth:StyleSheet.hairlineWidth,
                //elevation: 5,
                flexDirection: 'row',
                alignItems: 'center',
              }}>
              <Text
                style={{
                  // textAlign: 'left',
                  // fontFamily: theme.fonts.SemiBold,
                  // color: 'white',
                  // fontSize: theme.hp(3),
                  // paddingLeft: theme.wp(3),
                  // paddingVertical: theme.wp(3),
                  // borderWidth:StyleSheet.hairlineWidth,
                  //  elevation: 5,
                  flex: 1,
                  //backgroundColor: 'red',
                }}
              />
              <TouchableOpacity
                style={{
                  paddingHorizontal: 15,
                  paddingTop: 15,
                  // backgroundColor: 'green',
                }}
                onPress={onRequestClose}>
                <FontAwesome5 name={'times'} size={18} color={'gray'} />
              </TouchableOpacity>
            </View>
          ) : (
            <View
              style={{
                // backgroundColor: theme.colors.primaryColor,
                paddingVertical: 8,
                // borderBottomWidth: StyleSheet.hairlineWidth,
                // borderBottomColor: '#aaa',
                flexDirection: 'row',

                alignItems: 'center',
              }}>
              <Text
                style={{
                  flex: 1,
                  //  marginTop:2
                  paddingLeft: 15,
                }}
                color={themeData.textColor}
                semibold
                size={16}>
                {title}
              </Text>

              {/* <Text
                  style={{
                    textAlign: 'center',
                    fontFamily: theme.fonts.SemiBold,
                    color: 'white',
                    fontSize: theme.hp(2.2),
                    paddingLeft: theme.wp(3),
                    // paddingVertical: theme.wp(3),
                    // borderWidth:StyleSheet.hairlineWidth,
                    //  elevation: 5,
                    flex: 1,
                    //backgroundColor: 'red',
                  }}>
                  {title}
                </Text> */}
              <TouchableOpacity
                style={{
                  paddingHorizontal: 10,
                  paddingVertical: 5,
                  // opacity: 0.9,
                  // backgroundColor: 'green',
                  alignSelf: 'flex-start',
                }}
                onPress={onRequestClose}>
                  <TimesIcon color={themeData.darkMode?'#E4E3E8':'#A1A1AA'}/>
                {/* <FontAwesome5 name={'times'} size={18} color={'gray'} /> */}
              </TouchableOpacity>
            </View>
          )}
          <ConELE
            showsVerticalScrollIndicator={false}
            keyboardShouldPersistTaps="handled"
            style={{
              paddingHorizontal: 10,
              // paddingVertical: 10,
              //  backgroundColor: 'blue',
              // flex: 1,
            }}
            contentContainerStyle={{
              paddingVertical: 10,
            }}>
            {children}
          </ConELE>

          {renderFooter && (
            <View style={{paddingHorizontal: 10, paddingVertical: 10}}>
              {renderFooter()}
            </View>
          )}
          {/* <AppProgess height="100%" /> */}
        </View>
        <AppProgess />
      </SafeAreaView>
    </Modal>
  );
}
const ModalContainer = memo(_ModalContainer);
export default ModalContainer;

const inStyle = StyleSheet.create({
  scrollView: {
    flex: 1,
  },
  row: {
    paddingBottom: theme.hp(1.7),
    paddingHorizontal: theme.paddingHorizontal,
    marginTop: theme.hp(1.7),
  },
  body: {
    width: '100%',
    backgroundColor: '#fff',
    shadowColor: '#000',
    shadowOffset: {
      width: 0,
      height: 7,
    },
    shadowOpacity: 0.41,
    shadowRadius: 9.11,

    elevation: 5,
    borderRadius: 3,
    paddingHorizontal: theme.hp(1.7),
    paddingVertical: theme.hp(1.7),
  },
  title: {
    textAlign: 'center',
    fontFamily: theme.fonts.SemiBold,
    color: theme.colors.primaryColor,
    fontSize: theme.hp(3),
  },
  container: {
    //  backgroundColor:'blue',
    paddingHorizontal: theme.hp(1.4),
    paddingVertical: theme.hp(1.4),
  },
});
